<script src='paho-mqtt.js'></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
<script>
    var client;
    
    function MQTTConnect() {
        client = new Paho.MQTT.Client('broker.hivemq.com', 8000, '');
        var options = {   timeout: 10,
                        keepAliveInterval: 10,
                        onSuccess: onConnect,
                        onFailure: onError
                        };
        client.onMessageArrived = onMessageArrived;
        client.onConnectionLost = onError;
        client.connect(options);
    }
    
    function onConnect() {
        console.log('Connected');
        client.subscribe('dev/sc01');
        let message = new Paho.MQTT.Message(`{"method":"GET", "sensor":"temperatureSensor", "data": ${Math.floor(Math.random() * (48 - 16 + 1) ) + 16}}`);
        message.destinationName = 'dev/sc01';
        client.send(message);
    }

    function onError(message) {
      // Ocorrencia de erro
      console.log('Falha: ' + message.errorCode + ' ' + message.errorMessage);
      setTimeout(MQTTConnect, 2000);
    }

    function onMessageArrived(msg) {
        console.log("Mensagem: " + msg.destinationName + "=" + msg.payloadString);
        /* let h1 = document.createElement('h1');
        h1.appendChild(document.createTextNode(message.payloadString));
        document.getElementById('message-list').appendChild(h1); */
    }
</script>

<body onload="MQTTConnect()">
    
</body>